{% extends "layout.html" %}
{% block content %}
<div class="row">
  <div class="col-lg-8">
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h2 class="mb-4"><i class="bi bi-book"></i> Инструкция по использованию Mektep Desktop</h2>
        
        <h5>Для учителей</h5>
        <p class="text-muted">Учителя работают только через десктопное приложение Mektep Desktop. Вход в кабинет через сайт недоступен.</p>
        
        <div class="alert alert-info mb-3">
          <strong>Важно:</strong> В приложении используются <strong>два разных логина</strong>:
          <ul class="mb-0 mt-1">
            <li><strong>Логин от платформы</strong> — выдаёт администратор школы (для входа в приложение)</li>
            <li><strong>Логин от mektep.edu.kz</strong> — ваш ИИН и пароль от государственного портала (для создания отчётов)</li>
          </ul>
        </div>
        
        <hr>
        
        <h5>Шаг 1: Скачайте и запустите</h5>
        <p>Нажмите кнопку <strong>«Скачать приложение»</strong> справа. Загрузится файл <strong>Mektep Desktop.exe</strong>. Сохраните его в удобную папку и запустите двойным щелчком.</p>
        <p class="text-muted small">При первом запуске Windows может показать предупреждение SmartScreen — нажмите «Подробнее» и затем «Выполнить в любом случае».</p>
        
        <h5>Шаг 2: Вход в приложение</h5>
        <p>При запуске появится окно авторизации. Введите <strong>логин и пароль от платформы</strong>, которые выдал администратор школы. Отметьте «Запомнить меня», чтобы не вводить пароль повторно. Приложение само свяжется с платформой — запускать сервер вручную не нужно.</p>
        
        <h5>Шаг 3: Создание отчётов</h5>
        <p>В левой панели окна:</p>
        <ol>
          <li>Введите <strong>логин и пароль от mektep.edu.kz</strong> (ИИН и пароль от государственного портала)</li>
          <li>Выберите <strong>четверть</strong> и <strong>язык</strong> отчётов</li>
          <li>При необходимости укажите папку для сохранения</li>
          <li>Нажмите <strong>«Запустить»</strong></li>
        </ol>
        <p class="text-muted small">Приложение автоматически соберёт данные с mektep.edu.kz, сформирует Excel- и Word-отчёты и загрузит результаты на сервер платформы.</p>
        
        <h5>Шаг 4: Работа с отчётами</h5>
        <p>После создания отчётов доступны <strong>4 вкладки</strong> в правой части окна:</p>
        <ul>
          <li><strong>Мои отчёты</strong> — список всех созданных отчётов. Можно открыть Excel/Word файл, открыть папку или удалить отчёт</li>
          <li><strong>Оценки по классам</strong> — таблица оценок учеников по предметам с процентами качества и успеваемости. Подсвечивает пограничные оценки</li>
          <li><strong>Предметник</strong> — отчёт учителя-предметника: качество и успеваемость по классам, аналитика по СОР/СОЧ</li>
          <li><strong>Кл. руководитель</strong> — отчёт классного руководителя: отличники, хорошисты, с одной «4», троечники, с одной «3», неуспевающие</li>
        </ul>
        <p class="text-muted small">Каждую вкладку можно экспортировать в Excel с помощью кнопки <strong>«Экспорт в Excel»</strong>.</p>
        
        <h5>Шаг 5: Цели обучения и генерация анализа (AI)</h5>
        <p>Во вкладке «Мои отчёты» нажмите кнопку <strong>«Цели»</strong>. В открывшемся окне:</p>
        <ol>
          <li>Для каждого типа оценивания (СОР1, СОР2, СОР3, СОЧ) заполните:
            <ul>
              <li><strong>Достигнутые цели</strong> — что учащиеся усвоили</li>
              <li><strong>Цели, вызвавшие затруднения</strong> — что вызвало трудности (обязательно для генерации)</li>
            </ul>
          </li>
          <li>Нажмите <strong>«Генерировать анализ (AI)»</strong> — система автоматически заполнит перечень затруднений, причины и план коррекционной работы</li>
          <li>Отметьте отчёты, к которым применить цели, и нажмите <strong>«Применить к выбранным отчетам»</strong></li>
        </ol>
        <p class="text-muted small mb-0">Анализ будет записан в Word-документы выбранных отчётов.</p>
        
        <hr>
        
        <h5>Настройки</h5>
        <p>Нажмите на значок шестерёнки в верхней части окна. Доступные настройки:</p>
        <ul>
          <li><strong>Сервер</strong> — адрес платформы и проверка подключения</li>
          <li><strong>Папка отчётов</strong> — путь для сохранения отчётов (по умолчанию: <code>Документы/Mektep Reports</code>)</li>
          <li><strong>Язык</strong> — русский или казахский интерфейс (требуется перезапуск)</li>
        </ul>
        
        <hr>
        
        <h5>Частые проблемы</h5>
        <ul>
          <li><strong>Не удаётся войти / нет подключения</strong> — проверьте интернет. Если проблема сохраняется, обратитесь к администратору — возможно, сервер платформы временно недоступен.</li>
          <li><strong>Квота исчерпана</strong> — обратитесь к администратору школы для увеличения лимита.</li>
          <li><strong>Неверный логин</strong> — при входе используйте логин и пароль от платформы, выданные администратором. При создании отчётов — отдельный ИИН и пароль от mektep.edu.kz.</li>
          <li><strong>Предупреждение SmartScreen</strong> — нажмите «Подробнее» → «Выполнить в любом случае».</li>
          <li><strong>Отчёты не загружаются на сервер</strong> — убедитесь, что ваша школа зарегистрирована на платформе. Обратитесь к администратору.</li>
        </ul>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <!-- Вход для админов и супер админов -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h5 class="mb-3"><i class="bi bi-box-arrow-in-right"></i> Вход для администраторов</h5>
        <p class="text-muted small">Только для админов школ и супер-админов. Учителя входят через десктопное приложение.</p>
        <form method="post" action="{{ url_for('auth.login_post') }}">
          <div class="mb-3">
            <label class="form-label">Логин</label>
            <input class="form-control" name="username" autocomplete="username" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Пароль</label>
            <input class="form-control" name="password" type="password" autocomplete="current-password" required>
          </div>
          <button class="btn btn-primary w-100">Войти</button>
        </form>
      </div>
    </div>

    <!-- Скачивание десктопной версии -->
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="mb-3"><i class="bi bi-download"></i> Скачать Mektep Desktop</h5>
        {% if download_url %}
          <a href="{{ download_url }}" class="btn btn-success w-100 mb-2" target="_blank" rel="noopener">
            <i class="bi bi-download"></i> Скачать приложение
          </a>
        {% elif download_available %}
          <a href="{{ url_for('main.download_desktop') }}" class="btn btn-success w-100 mb-2">
            <i class="bi bi-download"></i> Скачать приложение
          </a>
        {% else %}
          <div class="alert alert-warning small mb-2">
            Файл сборки пока не загружен. Обратитесь к администратору или соберите приложение самостоятельно:
          </div>
          <code class="d-block small">cd mektep-desktop && pyinstaller mektep_desktop.spec</code>
        {% endif %}
        <p class="text-muted small mt-2 mb-0">
          Требуется: Windows. После скачивания сохраните файл и запустите Mektep Desktop.exe
        </p>
      </div>
    </div>
  </div>
</div>
{% endblock %}
