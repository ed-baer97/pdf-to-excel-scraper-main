{% extends "layout.html" %}
{% block content %}
<div class="container-fluid py-3">
  <h3 class="mb-4">{{ _('grades_overview') }}</h3>
  
  <!-- Фильтры -->
  <div class="card shadow-sm mb-4">
    <div class="card-body">
      <form method="get" class="row g-3 align-items-end">
        <div class="col-md-3">
          <label class="form-label">{{ _('period_type') }}</label>
          <select name="period_type" class="form-select">
            <option value="quarter" {% if period_type == 'quarter' %}selected{% endif %}>{{ _('quarter_label') }}</option>
            <option value="semester" {% if period_type == 'semester' %}selected{% endif %}>{{ _('semester_label') }}</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">{{ _('period_number') }}</label>
          <select name="period_number" class="form-select">
            {% if period_type == 'quarter' %}
              {% for i in range(1, 5) %}
                <option value="{{ i }}" {% if period_number == i %}selected{% endif %}>{{ i }} {{ _('quarter_suffix') }}</option>
              {% endfor %}
            {% else %}
              {% for i in range(1, 3) %}
                <option value="{{ i }}" {% if period_number == i %}selected{% endif %}>{{ i }} {{ _('semester_suffix') }}</option>
              {% endfor %}
            {% endif %}
          </select>
        </div>
        <div class="col-md-2">
          <button type="submit" class="btn btn-primary">{{ _('apply_btn') }}</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Список классов -->
  <div class="card shadow-sm">
    <div class="card-body">
      <h5 class="card-title mb-3">{{ _('classes') }}</h5>
      
      {% if classes %}
        <div class="accordion" id="gradesOverviewAccordion">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#grades-acc-1-4" aria-expanded="true">
                {{ _('classes_1_4') }} <span class="badge bg-secondary ms-2">{{ classes_by_accordion['1-4']|length }}</span>
              </button>
            </h2>
            <div id="grades-acc-1-4" class="accordion-collapse collapse show" data-bs-parent="#gradesOverviewAccordion">
              <div class="accordion-body p-0">
                <table class="table table-hover mb-0">
                  <thead class="table-light"><tr><th>{{ _('class_col') }}</th><th>{{ _('students_count') }}</th><th>{{ _('subjects') }}</th><th>{{ _('actions') }}</th></tr></thead>
                  <tbody>
                    {% for cls in classes_by_accordion['1-4'] %}
                    <tr>
                      <td><strong>{{ cls.class_name }}</strong></td>
                      <td>{{ cls.students_count }}</td>
                      <td><span class="badge bg-secondary">{{ cls.subjects|length }} {{ _('subjects_count') }}</span></td>
                      <td><a href="{{ url_for('admin.grades_class', class_name=cls.class_name, period_type=period_type, period_number=period_number) }}" class="btn btn-sm btn-outline-primary">{{ _('summary_table') }}</a></td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" class="text-muted">{{ _('no_data') }}</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#grades-acc-5-9" aria-expanded="false">
                {{ _('classes_5_9') }} <span class="badge bg-secondary ms-2">{{ classes_by_accordion['5-9']|length }}</span>
              </button>
            </h2>
            <div id="grades-acc-5-9" class="accordion-collapse collapse" data-bs-parent="#gradesOverviewAccordion">
              <div class="accordion-body p-0">
                <table class="table table-hover mb-0">
                  <thead class="table-light"><tr><th>{{ _('class_col') }}</th><th>{{ _('students_count') }}</th><th>{{ _('subjects') }}</th><th>{{ _('actions') }}</th></tr></thead>
                  <tbody>
                    {% for cls in classes_by_accordion['5-9'] %}
                    <tr>
                      <td><strong>{{ cls.class_name }}</strong></td>
                      <td>{{ cls.students_count }}</td>
                      <td><span class="badge bg-secondary">{{ cls.subjects|length }} {{ _('subjects_count') }}</span></td>
                      <td><a href="{{ url_for('admin.grades_class', class_name=cls.class_name, period_type=period_type, period_number=period_number) }}" class="btn btn-sm btn-outline-primary">{{ _('summary_table') }}</a></td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" class="text-muted">{{ _('no_data') }}</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#grades-acc-10-11" aria-expanded="false">
                {{ _('classes_10_11') }} <span class="badge bg-secondary ms-2">{{ classes_by_accordion['10-11']|length }}</span>
              </button>
            </h2>
            <div id="grades-acc-10-11" class="accordion-collapse collapse" data-bs-parent="#gradesOverviewAccordion">
              <div class="accordion-body p-0">
                <table class="table table-hover mb-0">
                  <thead class="table-light"><tr><th>{{ _('class_col') }}</th><th>{{ _('students_count') }}</th><th>{{ _('subjects') }}</th><th>{{ _('actions') }}</th></tr></thead>
                  <tbody>
                    {% for cls in classes_by_accordion['10-11'] %}
                    <tr>
                      <td><strong>{{ cls.class_name }}</strong></td>
                      <td>{{ cls.students_count }}</td>
                      <td><span class="badge bg-secondary">{{ cls.subjects|length }} {{ _('subjects_count') }}</span></td>
                      <td><a href="{{ url_for('admin.grades_class', class_name=cls.class_name, period_type=period_type, period_number=period_number) }}" class="btn btn-sm btn-outline-primary">{{ _('summary_table') }}</a></td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" class="text-muted">{{ _('no_data') }}</td></tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <div class="alert alert-info">
          {{ _('no_data_period') }}
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
